import{_ as e,c as a,o,S as t}from"./chunks/framework.9c4db3f7.js";const x=JSON.parse('{"title":"微信支付相关","description":"","frontmatter":{},"headers":[],"relativePath":"notes/4.md","filePath":"notes/4.md","lastUpdated":1693141135000}'),s={name:"notes/4.md"},p=t('<h1 id="微信支付相关" tabindex="-1">微信支付相关 <a class="header-anchor" href="#微信支付相关" aria-label="Permalink to &quot;微信支付相关&quot;">​</a></h1><div class="tip custom-block"><p class="custom-block-title">原文地址</p><p><a href="https://github.com/tangxve/notes/issues/4" target="_blank" rel="noreferrer">微信支付相关 | GitHub</a></p></div><p>发现很久之前写的微信支付内容，整理下发出来</p><h2 id="静默授权" tabindex="-1">静默授权 <a class="header-anchor" href="#静默授权" aria-label="Permalink to &quot;静默授权&quot;">​</a></h2><p>用户入口链接，每次进入项目都会需要授权，先去检查当前 URL 下面是否有code， 如果没有就把当前URL传给微信授权的链接，微信授权会回调这个URL并把code附加到url里面</p><p>获取code的value后传给后台，后台返回相对应的 业务ID</p><p>参考链接：<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140842" target="_blank" rel="noreferrer">https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140842</a></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>注意：传给微授权的url一定要编码</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> oauthCallbackUrl </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">encodeURIComponent</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://newpay.tunnel.qydev.com/VAOrderH5</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><h2 id="ios-和-android-认为当前页的-url" tabindex="-1">IOS 和 Android 认为当前页的 URL <a class="header-anchor" href="#ios-和-android-认为当前页的-url" aria-label="Permalink to &quot;IOS 和 Android 认为当前页的 URL&quot;">​</a></h2><h3 id="当前页-和-着陆页" tabindex="-1">当前页 和 着陆页： <a class="header-anchor" href="#当前页-和-着陆页" aria-label="Permalink to &quot;当前页 和 着陆页：&quot;">​</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>着陆页：当我们从微信别的地方点击链接呼出微信浏览器时所落在的页面、或者点击微信浏览器的刷新按钮时所刷新的页面，我们叫做 Landing Page。</p><p>当前页：当前浏览器的页面首先把当前页面叫做 Current Page。</p></div><p>举个例子：</p><p>我们从任何地方点击链接进入页面A，然后依次浏览到 B、C、D</p><p><strong>那么 Current Page 就是D，而 Landing Page 是 A</strong>，</p><p>如果此时我们在 D 页面点击一下浏览器的刷新按钮，那么 Landing Page 就变成了 D</p><h3 id="不同系统的判断规则不一样" tabindex="-1">不同系统的判断规则不一样 <a class="header-anchor" href="#不同系统的判断规则不一样" aria-label="Permalink to &quot;不同系统的判断规则不一样&quot;">​</a></h3><p><strong>问题来了，在iOS和安卓下呼出微信支付的时候，微信支付判断当前路径的规则分别是：</strong></p><p>IOS：Landing Page</p><p>安卓：Current Page</p><p>这就意味着，在 ios 环境下，任何一个页面都有可能成为支付页面</p><p><strong>解决方法：</strong></p><p>URL上在 <code>#</code> 前面加个 <code>?</code></p><p>原有3个页面用到微信支付：</p><p><code>http://xxxxx.com/#/cart/pay1</code></p><p><code>http://xxxxx.com/#/order/pay2</code></p><p><code>http://xxxx.com/#/order/pay3</code></p><p>现在：</p><p><code>http://xxxx.com/?#/order/orderinfo</code></p><p>微信浏览器会把？后面省略了。</p><p>最主要的：只需要把授权目录配置到：<code>http://xxxx.com/</code> 即可，在微信开发者平台上配置支付域名</p>',30),r=[p];function n(c,l,i,d,h,m){return o(),a("div",null,r)}const _=e(s,[["render",n]]);export{x as __pageData,_ as default};
